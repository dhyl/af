function GetQueryString(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)"),c=window.location.search.substr(1).match(b);return null!=c?unescape(c[2]):null}var dnx="全部";!function(){var a="ontouchstart"in window,b=a?"touchstart":"click",c={width:$(window).width(),height:$(window).height()},d=300,e={Page:"video",Init:function(){var a=[];a.push("./images/bg.gif"),a.push("./images/logo.png"),a.push("./images/mCSB_buttons.png"),a.push("./images/loading.gif"),e.Load(a,function(){$("#logo").on(b,function(a){a.preventDefault(),$("#about").addClass("md-modal-show"),$(".md-mask").addClass("md-mask-show"),$("#header,#video").addClass("md-blur"),$("#about .fa-times-circle").on(b,function(a){a.preventDefault(),$(".md-modal").removeClass("md-modal-show"),$(".md-mask").removeClass("md-mask-show"),$("#header,#video,#music,#footer").removeClass("md-blur"),$(this).off(b),e.State(xtit+" - 最新最好的视频云库","./")}),e.State("关于我们 - "+xtit,"?a=about")}),$("#video").height(c.height-46),$("#type span").on(b,function(a){var b,c;a.preventDefault(),b=$(this),c=b.text(),dnx=c,e.Init(),$("#type span").removeClass("active"),b.addClass("active")}),$(document).keydown(function(a){if("visible"==$("#play").css("visibility")){var c=$("#play-list li.active");38==a.keyCode?c.prev().length>0?c.prev().trigger(b):c.siblings("div:last").trigger(b):40==a.keyCode&&(c.next().length>0?c.next().trigger(b):c.siblings("div:eq(0)").trigger(b))}}),$(".fa-search").on(b,function(){var a=$("#video-search"),b=$.trim(a.val());return""==b?(alert("请输入关键字！"),$(".video-item").show(),!1):($(".video-item").hide(),$(".video-item[data-name*='"+b+"']").show(),$("#type span").removeClass("active"),void 0)}),$("#video-search").on("keydown",function(a){var c,b=$(this);if(13==a.keyCode){if(c=$.trim(b.val()),""==c)return alert("请输入关键字！"),$(".video-item").show(),!1;$(".video-item").hide(),$(".video-item[data-name*='"+c+"']").show()}}),$("#player-share .fa-weibo").on(b,function(a){a.preventDefault(),e.Share.Weibo(location.href,$("#play h3 span").html()+" "+$("#play h3 small").html())}),$("#player-share .fa-qq").on(b,function(a){a.preventDefault(),e.Share.QQ(location.href,$("#play h3 span").html()+" "+$("#play h3 small").html())}),$(document).on(b,"a.play",function(a){var b,c,d;a.preventDefault(),b=$(this),c=b.data("id"),d=""==$.trim(b.data("index"))?0:b.data("index"),e.Video.Play(c,d)}),$(document).on(b,"#play-list ul li",function(a){var b,c,d,f,g,h,i;a.preventDefault(),b=$(this),c=b.data("index"),d=b.data("id"),f=b.data("vid"),g=b.data("type"),h=b.text(),e.Data.Click(d),$("#play-list ul li").removeClass("active"),b.addClass("active"),$("#play h3 small").html(h),i="",/^http\:\/\//i.test(f)?i=e.Player.SWF(f):(0==g&&(i=e.Player.Youku(f)),1==g&&(i=e.Player.Sohu(f)),2==g&&(i=e.Player.Letv(f)),3==g&&(i=e.Player.Tudou(f)),4==g&&(i=e.Player.QQ(f)),5==g&&(i=e.Player.PPTV(f)),6==g&&(i=e.Player.Qiyi(f)),7==g&&(i=e.Player.Sina(f))),$("#player").html(i),"last"==c&&(c=$("#play-list ul li").last().data("index")),$.cookie("video_item_"+d,c),e.State($("#play h3 span").html()+" "+$("#play h3 small").html()+" - "+xtit,"?play="+d+"&p="+c)}),e.Resize(),e.StateListen(),e.Data.All(function(){setTimeout(function(){$("#loading").fadeOut(),$("#video").mCustomScrollbar("update")},1e3)})},0),$(document.body).attr({onSelectStart:"return false;",oncontextmenu:"return false;",ondragstart:"return false;",style:"-moz-user-select: none; -khtml-user-select: none; user-select: none;"})},Resize:function(){$(window).on("resize",function(){c={width:$(window).width(),height:$(window).height()},$("#video").height(c.height-46)})},Load:function(a,b,c){var h,d=0,e=0,f=a.length,g=function(a){$("<img />").attr("src",a).on("load",function(){d++,e=100*(d/f),$("#loading-percent").text(Math.ceil(e)+"%"),$("#loading-bar span").width(Math.ceil(e)+"%"),d==f&&setTimeout(function(){b()},c)})};for(h=0;f>h;h++)g(a[h])},Data:{Template:{VideoItemLoop:function(a){var b=["周日","周一","周二","周三","周四","周五","周六"],c="";return c+='<a href="javascript:;" class="video-item pr pull-left play" data-name="'+a.name+'" data-type="'+a.type+'" data-id="'+a.id+'" data-index="'+(0==a.update?"1":"last")+'">',c+='<div class="video-update pa'+(0==a.update?" done":"")+'">'+(0==a.update?'<i class="fa fa-check-circle"></i>&nbsp;完结':'<i class="fa fa-retweet"></i>&nbsp;连载')+"</div>",1==a.update&&(c+='<div class="video-week pa"><i class="fa fa-calendar"></i>&nbsp;'+b[a.week]+"</div>",c+='<div class="video-number pa">更新第'+a.number+"集</div>"),c+='<img src="'+a.cover+'" class="video-thumb">',c+='<i class="fa fa-play-circle-o pa"></i>',c+='<p class="video-name pa">'+a.name+"</p></a>"}},All:function(a){$.getJSON("./api/?nx="+dnx,function(b){var c="";$(b).each(function(a,b){c+=e.Data.Template.VideoItemLoop(b)}),c+='<div class="clear"></div><br>',$("#video").html(c),a()})},Info:function(a,b){$.ajax({dataType:"JSON",type:"post",url:"./api/video/",data:"id="+a,success:function(a){if(null==a.item)return alert("服务器操作超时！"),!1;$("#play h3 span").html(a.name);var c="<ul>";$(a.item).each(function(b,d){c+='<li id="playlist'+b+'" data-index="'+b+'" data-type="'+d[0]+'" data-id="'+a.id+'" data-vid="'+d[2]+'">'+d[1]+"</li>"}),c+="</ul>",$("#play-list").html(c),b()}})},Click:function(a){$.post("./api/click/",{id:a})}},Video:{Play:function(a,c){e.Data.Info(a,function(){$(".md-mask").addClass("md-mask-show"),$("#play").addClass("md-modal-show"),$("#play-list").mCustomScrollbar({scrollButtons:{enable:!1},scrollInertia:d,theme:"dark-thick"}),null!=$.cookie("video_item_"+a)?(c="last"==c?$("#play-list ul li").last().data("index"):$.cookie("video_item_"+a),$("#play-list ul li").eq(c).trigger(b),$("#play-list").mCustomScrollbar("scrollTo","#playlist"+c)):"last"==c?($("#play-list ul li").last().trigger(b),$("#play-list").mCustomScrollbar("scrollTo","last")):($("#play-list ul li").eq(c).trigger(b),$("#play-list").mCustomScrollbar("scrollTo","#playlist"+c)),$("#play .md-content .fa-times-circle").on(b,function(a){a.preventDefault(),$("#baidu").hide(),$(".md-modal").removeClass("md-modal-show"),$(".md-mask").removeClass("md-mask-show"),setTimeout(function(){$("#player").empty()},600),$(this).off(b),e.State(xtit+" - 最新最好的视频云库","./")}),"last"==c&&(c=$("#play-list ul li").last().data("index")),e.State($("#play h3 span").html()+" - "+$("#play h3 small").html()+" - "+xtit,"?play="+a+"&p="+c)})}},Player:{Width:636,Height:400,Youku:function(a){return play_url="http://static.youku.com/v1.0.0222/v/swf/player.swf?VideoIDS="+a,flashvars="MMControl=false&MMout=false&isShowRelatedVideo=false&amp;showAd=0&amp;show_pre=1&amp;show_next=1&amp;VideoIDS="+a+"&amp;isAutoPlay=true&amp;isDebug=false&amp;UserID=&amp;winType=interior&amp;playMovie=true&amp;RecordCode=1001,1002,1003,1004,1005,1006,2001,3001,3002,3003,3004,3005,3007,3008,9999","<embed class='youku' pluginspage=http://www.macromedia.com/go/getflashplayer src='"+play_url+"' width=\""+e.Player.Width+'" height="'+e.Player.Height+'" type=application/x-shockwave-flash flashvars="'+flashvars+'" allowscriptaccess="always" allowfullscreen="true" quality="high" wmode="opaque"></embed>'},Tudou:function(a){return'<embed class="tudou" type="application/x-shockwave-flash" src="http://tudou.com/v/'+a+'/&amp;autoPlay=true"  width="'+e.Player.Width+'" height="'+e.Player.Height+'" style="undefined" id="acgobject" name="acgobject" quality="high" allowfullscreen="true" allownetworking="internal" allowscriptaccess="always" wmode="opaque" flashvars="tvcCode=-1&amp;hd=2">'},Sohu:function(a){return play_url="http://share.vrs.sohu.com/"+a+"/v.swf&skinNum=1&topBar=0&showRecommend=0&autoplay=true",'<embed class="sohu" type="application/x-shockwave-flash" src="'+play_url+'" width="'+e.Player.Width+'" height="'+e.Player.Height+'" quality="high" allowfullscreen="true" allownetworking="internal" allowscriptaccess="always" wmode="opaque" flashvars="MMControl=false&amp;MMout=false">'},Letv:function(a){return play_url="http://i7.imgs.letv.com/player/swfPlayer.swf?id="+a+"&autoplay=1&isPlayerAd=0",'<embed class="sohu" type="application/x-shockwave-flash" src="'+play_url+'" width="'+e.Player.Width+'" height="'+e.Player.Height+'" quality="high" allowfullscreen="true" allownetworking="internal" allowscriptaccess="always" wmode="opaque" flashvars="MMControl=false&amp;MMout=false">'},Sina:function(a){return'<embed class="sohu" type="application/x-shockwave-flash" src="http://p.you.video.sina.com.cn/swf/bokePlayer20140403_V4_1_42_41.swf?vid='+a+'&clip_id=&imgurl=&auto=1&vblog=1&type=0&tabad=1&autoLoad=1&autoPlay=1&as=0&tjAD=0&tj=0&casualPlay=1&head=0&logo=0&share=0" width="'+e.Player.Width+'" height="'+e.Player.Height+'" quality="high" allowfullscreen="true" allownetworking="internal" allowscriptaccess="always" wmode="opaque" flashvars="MMControl=false&amp;MMout=false">'},Qiyi:function(a){return'<embed pluginspage="http://www.macromedia.com/go/getflashplayer" loop="true" play="true" quality="hight" scale="showall" devicefont="false" allowfullscreen="true" menu="true" type="application/x-shockwave-flash" width="'+e.Player.Width+'" height="'+e.Player.Height+'" src="http://player.video.qiyi.com/qiyi" id="acgobject" bgcolor="#000000" flashvars="vid='+a+'&amp;coop=coop_178&amp;bd=1&amp;autoPlay=1" align="middle" allownetworking="internal" allowscriptaccess="always">'},PPTV:function(a){return play_url=a.length>13?"http://player.pptv.com/v/"+a+".swf":"http://player.pptv.com/cid/"+a+".swf",'<embed class="sohu" type="application/x-shockwave-flash" src="'+play_url+'" width="'+e.Player.Width+'" height="'+e.Player.Height+'" quality="high" allowfullscreen="true" allownetworking="internal" allowscriptaccess="always" wmode="opaque" flashvars="MMControl=false&amp;MMout=false">'},QQ:function(a){return play_url="http://imgcache.qq.com/tencentvideo_v1/player/TencentPlayer.swf?_v=20110829&vid="+a+"&autoplay=1",'<embed class="sohu" type="application/x-shockwave-flash" src="'+play_url+'" width="'+e.Player.Width+'" height="'+e.Player.Height+'" quality="high" allowfullscreen="true" allownetworking="internal" allowscriptaccess="always" wmode="opaque" flashvars="MMControl=false&amp;MMout=false">'},FLV:function(){},SWF:function(a){return'<embed class="sohu" type="application/x-shockwave-flash" src="'+a+'" width="'+e.Player.Width+'" height="'+e.Player.Height+'" quality="high" allowfullscreen="true" allownetworking="internal" allowscriptaccess="always" wmode="opaque" flashvars="MMControl=false&amp;MMout=false">'}},Share:{QQ:function(a,b){var c=encodeURIComponent;window.open("http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?otype=share&url="+c(a)+"&title="+c(b))},Weibo:function(a,b){var c=encodeURIComponent;window.open("http://v.t.sina.com.cn/share/share.php?url="+c(a)+"&title="+c(b))}},State:function(a,b){window.history.pushState?window.history.pushState({title:a,url:b},a,b):location.href=b,document.title=a},StateListen:function(){var a=location.href.toString().split("/");"play"==a[3]?a[4]&&a[5]&&e.Video.Play(a[4],a[5]):(a[4]=GetQueryString("play"),a[5]=GetQueryString("p"),a[4]&&a[5]&&e.Video.Play(a[4],a[5])),"about"==a[3]&&$("#logo").trigger(b),"feedback"==a[3]&&$("#login").trigger(b),window.addEventListener("popstate",function(a){if(history.state){$(".fa-times-circle").trigger(b);var c=a.state.url;"play"==c&&e.Video.Play(c[4],c[5]),"about"==c&&$("#logo").trigger(b),"feedback"==c&&$("#login").trigger(b)}},!1)}};e.Init()}();